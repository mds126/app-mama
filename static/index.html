// gardez ici votre const verbs = [ ... ] tel que vous l'avez

let currentVerb = null;
let score = 0;
let attempts = 0;

// Choisir un nouveau verbe et remplir l'UI
function pickNewVerb() {
  const randomIndex = Math.floor(Math.random() * verbs.length);
  currentVerb = verbs[randomIndex];

  const baseEl = document.getElementById('base-verb');
  const frEl = document.getElementById('french-translation');
  const pastEl = document.getElementById('past');
  const ppEl = document.getElementById('participle');
  const fbEl = document.getElementById('feedback');

  if (baseEl) baseEl.textContent = currentVerb.infinitive;
  if (frEl) frEl.textContent = currentVerb.fr;

  if (pastEl) pastEl.value = '';
  if (ppEl) ppEl.value = '';
  if (fbEl) {
    fbEl.textContent = '';
    fbEl.className = 'feedback';
  }
}

// Autoriser plusieurs formes (ex: learnt/learned)
function matchesForm(input, correct) {
  if (!correct) return false;
  const user = input.trim().toLowerCase();
  return correct
    .toLowerCase()
    .split('/')
    .some(form => form.trim() === user);
}

// Mettre à jour la progression
function updateProgress() {
  const percent = attempts > 0 ? Math.round((score / attempts) * 100) : 0;
  const txt = document.getElementById('progress-text');
  const bar = document.getElementById('progress-bar');
  if (txt) txt.textContent = `${score} / ${attempts} (${percent}%)`;
  if (bar) bar.style.width = percent + '%';
}

// Valider
document.getElementById('validateBtn').addEventListener('click', () => {
  if (!currentVerb) return;

  const pastInput = document.getElementById('past').value.trim();
  const ppInput = document.getElementById('participle').value.trim();
  const fbEl = document.getElementById('feedback');

  if (!pastInput || !ppInput) {
    fbEl.textContent = 'Veuillez remplir les deux champs.';
    fbEl.className = 'feedback incorrect';
    return;
  }

  attempts++;

  const isCorrect =
    matchesForm(pastInput, currentVerb.past) &&
    matchesForm(ppInput, currentVerb.past_participle);

  if (isCorrect) {
    score++;
    fbEl.textContent = 'Correct ! ✔';
    fbEl.className = 'feedback correct';
  } else {
    fbEl.textContent = `Incorrect... Les réponses étaient : ${currentVerb.past} / ${currentVerb.past_participle}`;
    fbEl.className = 'feedback incorrect';
  }

  updateProgress();
});

// Nouveau
document.getElementById('newBtn').addEventListener('click', pickNewVerb);

// Reset
document.getElementById('resetBtn').addEventListener('click', () => {
  score = 0;
  attempts = 0;
  updateProgress();
  pickNewVerb();
});

// Initialisation quand le DOM est prêt
document.addEventListener('DOMContentLoaded', () => {
  pickNewVerb();
  updateProgress();
});
